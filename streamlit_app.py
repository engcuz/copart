import streamlit as st

# Function containing your auction logic
def calculate_total_cost(bid_price, title_status):
    title_fees = {
        'clean': [(0, 49.99, 1.0), (50.0, 99.99, 1.0), (100.0, 199.99, 25.0), (200.0, 299.99, 50.0), (300.0, 349.99, 75.0), (350.0, 399.99, 75.0), (400.0, 449.99, 110.0), (450.0, 499.99, 110.0), (500.0, 549.99, 125.0), (550.0, 599.99, 130.0), (600.0, 699.99, 140.0), (700.0, 799.99, 155.0), (800.0, 899.99, 170.0), (900.0, 999.99, 185.0), (1000.0, 1199.99, 200.0), (1200.0, 1299.99, 225.0), (1300.0, 1399.99, 240.0), (1400.0, 1499.99, 250.0), (1500.0, 1599.99, 260.0), (1600.0, 1699.99, 275.0), (1700.0, 1799.99, 285.0), (1800.0, 1999.99, 300.0), (2000.0, 2399.99, 325.0), (2400.0, 2499.99, 335.0), (2500.0, 2999.99, 350.0), (3000.0, 3499.99, 400.0), (3500.0, 3999.99, 455.0), (4000.0, 4499.99, 600.0), (4500.0, 4999.99, 625.0), (5000.0, 5499.99, 625.0), (5500.0, 5999.99, 625.0), (6000.0, 6499.99, 675.0), (6500.0, 6999.99, 675.0), (7000.0, 7499.99, 675.0), (7500.0, 7999.99, 690.0), (8000.0, 8499.99, 715.0), (8500.0, 8999.99, 715.0), (9000.0, 9999.99, 715.0), (10000.0, 10499.99, 720.0), (10500.0, 10999.99, 720.0), (11000.0, 11499.99, 720.0), (11500.0, 11999.99, 720.0), (12000.0, 12499.99, 720.0), (12500.0, 14999.99, 720.0), (15000, float('inf'), 0.0575)],
        'non': [(0, 49.99, 1.0), (50.0, 99.99, 1.0), (100.0, 199.99, 25.0), (200.0, 299.99, 60.0), (300.0, 349.99, 85.0), (350.0, 399.99, 100.0), (400.0, 449.99, 125.0), (450.0, 499.99, 135.0), (500.0, 549.99, 145.0), (550.0, 599.99, 155.0), (600.0, 699.99, 170.0), (700.0, 799.99, 195.0), (800.0, 899.99, 215.0), (900.0, 999.99, 230.0), (1000.0, 1199.99, 250.0), (1200.0, 1299.99, 270.0), (1300.0, 1399.99, 285.0), (1400.0, 1499.99, 300.0), (1500.0, 1599.99, 315.0), (1600.0, 1699.99, 330.0), (1700.0, 1799.99, 350.0), (1800.0, 1999.99, 370.0), (2000.0, 2399.99, 390.0), (2400.0, 2499.99, 425.0), (2500.0, 2999.99, 460.0), (3000.0, 3499.99, 505.0), (3500.0, 3999.99, 555.0), (4000.0, 4499.99, 600.0), (4500.0, 4999.99, 625.0), (5000.0, 5499.99, 650.0), (5500.0, 5999.99, 675.0), (6000.0, 6499.99, 700.0), (6500.0, 6999.99, 720.0), (7000.0, 7499.99, 755.0), (7500.0, 7999.99, 775.0), (8000.0, 8499.99, 800.0), (8500.0, 8999.99, 820.0), (9000.0, 9999.99, 820.0), (10000.0, 10499.99, 850.0), (10500.0, 10999.99, 850.0), (11000.0, 11499.99, 850.0), (11500.0, 11999.99, 860.0), (12000.0, 12499.99, 875.0), (12500.0, 14999.99, 890.0), (15000, float('inf'), 0.06)],
    }
    virtual_bid_fees = [(0, 99.99, 0), (100.0, 499.99, 49.0), (500.0, 999.99, 59.0), (1000.0, 1499.99, 79.0), (1500.0, 1999.99, 89.0), (2000.0, 3999.99, 99.0), (4000.0, 5999.99, 109.0), (6000.0, 7999.99, 139.0), (8000, float('inf'), 149.0)]

    title_fee = 0
    for start, end, fee in title_fees[title_status]:
        if start <= bid_price <= end:
            title_fee = bid_price * fee if bid_price > 15000 else fee
            break

    v_fee = next((f for s, e, f in virtual_bid_fees if s <= bid_price <= e), 0)
    ship_f, gate_f, env_f = 20.0, (79.0 if title_status == 'clean' else 95.0), (0.0 if title_status == 'clean' else 15.0)
    total = bid_price + title_fee + v_fee + gate_f + env_f + ship_f
    return total, title_fee, v_fee, gate_f, env_f, ship_f

# --- Streamlit Interface ---
st.set_page_config(page_title="Copart Estimator", layout="centered")
st.title("ðŸš— Copart Bid Estimator")

bid = st.number_input("Final Bid Price ($)", min_value=0.0, value=5000.0, step=100.0)
status = st.selectbox("Title Status", ["Clean", "Non-Clean"]).lower()
if status == "non-clean": status = "non"

dealer_fees = st.number_input("Dealer Fees ($)", value=150.0)
towing_fees = st.number_input("Towing Fees ($)", value=120.0)

if st.button("Calculate Total"):
    total_auc, t_f, v_f, g_f, e_f, s_f = calculate_total_cost(bid, status)
    grand_total = total_auc + dealer_fees + towing_fees
    
    st.divider()
    st.metric("GRAND TOTAL", f"${grand_total:,.2f}")
    
    with st.expander("Fee Breakdown"):
        st.write(f"**Auction Total:** ${total_auc:,.2f}")
        st.write(f"**Title Fee:** ${t_f:.2f} | **Virtual Fee:** ${v_f:.2f}")
        st.write(f"**Gate Fee:** ${g_f:.2f} | **Env Fee:** ${e_f:.2f}")
